<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Webcam Video Stream</title>
</head>
<body>
    <h1>Webcam Video Stream</h1>
    <video id="webcam" autoplay playsinline></video>
    <button id="captureButton" type="button">Capture and Send</button>
    <script>
        // Get the video element and access the webcam
        const videoElement = document.getElementById('webcam');
        const captureButton = document.getElementById('captureButton');
        const fileInput = document.getElementById('fileInput');
        const uploadForm = document.getElementById('uploadForm');

        let stream;

        // Check if the browser supports getUserMedia
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            // Request access to the webcam
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(function (videoStream) {
                    // Display the webcam stream in the video element
                    videoElement.srcObject = videoStream;
                    stream = videoStream;
                })
                .catch(function (error) {
                    console.error('Error accessing the webcam:', error);
                });

            // Capture and send the current frame when the button is clicked
            captureButton.addEventListener('click', function () {
                if (stream) {
                    const canvas = document.createElement('canvas');
                    canvas.width = videoElement.videoWidth;
                    canvas.height = videoElement.videoHeight;
                    const context = canvas.getContext('2d');
                    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
                    
                    const picture = canvas.toDataURL()

                    fetch('http://192.168.0.180:8000/trialpath', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json', // Set content type to JSON
                        },
                        body: JSON.stringify({image: picture}),
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
                }
            });
        } else {
            console.error('getUserMedia is not supported in this browser.');
        }
    </script>
</body>
</html>
